{% extends 'base.html' %}

{% block head %}
<style>
    .prediction-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem;
    }

    .page-title {
        text-align: center;
        font-size: 2.8rem;
        margin-bottom: 3rem;
        color: var(--text-dark);
    }

    .top-actions {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .upload-zone {
        border: 2px dashed var(--primary-start);
        border-radius: var(--card-radius);
        padding: 3rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: none;
        /* custom cursor */
        background: rgba(79, 140, 255, 0.05);
    }

    .upload-zone.magnetic:hover,
    .upload-zone.dragover {
        background: rgba(79, 140, 255, 0.15);
        border-color: var(--primary-end);
    }

    .upload-icon {
        font-size: 3rem;
        color: var(--primary-start);
        margin-bottom: 1rem;
    }

    .upload-text {
        font-size: 1.2rem;
        color: var(--text-dark);
    }

    .generator-section {
        text-align: center;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .form-label {
        font-weight: 600;
        color: var(--text-dark);
        font-size: 0.95rem;
    }

    .form-input {
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(79, 140, 255, 0.3);
        border-radius: 8px;
        padding: 0.8rem 1rem;
        color: var(--text-dark);
        font-family: inherit;
        transition: all 0.3s ease;
        cursor: none;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary-start);
        box-shadow: 0 0 15px rgba(79, 140, 255, 0.2);
    }

    /* Light output card specific */
    .output-card-container {
        display: none;
        margin-top: 3rem;
    }

    .output-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 1.5rem;
    }

    .progress-circle {
        position: relative;
        width: 160px;
        height: 160px;
        border-radius: 50%;
        /* Will be overwritten dynamically */
        background: conic-gradient(var(--primary-start) 0%, rgba(0, 0, 0, 0.05) 0%);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 30px rgba(79, 140, 255, 0.2);
        transition: background 0.1s linear, box-shadow 0.5s ease;
    }

    .progress-inner {
        width: 140px;
        height: 140px;
        border-radius: 50%;
        background: var(--bg-light);
        /* Knockout to background color */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: inset 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    .score-value {
        font-size: 3rem;
        font-weight: 800;
        color: var(--text-dark);
        line-height: 1;
    }

    .score-label {
        font-size: 0.85rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 0.2rem;
    }

    .performance-status {
        font-size: 1.5rem;
        font-weight: 700;
    }
</style>
{% endblock %}

{% block content %}
<div class="prediction-container">
    <h1 class="page-title">Performance <span class="text-gradient">Engine</span></h1>

    <div class="top-actions">
        <!-- Section 1: Drag & Drop Upload -->
        <div class="upload-zone magnetic" id="uploadZone">
            <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
            <p class="upload-text">Drag & Drop CSV Dataset here or <strong class="text-cyan">Click to Browse</strong>
            </p>
            <input type="file" id="fileInput" hidden accept=".csv">
        </div>

        <!-- Section 2: Synthetic Data Generator -->
        <div class="generator-section">
            <button type="button" class="btn-outline magnetic" id="btnGenerate">
                <i class="fa-solid fa-wand-magic-sparkles"></i> Load Sample Data
            </button>
        </div>
    </div>

    <!-- Section 3: Input Form -->
    <div class="glass-card">
        <form id="predictionForm">
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Attendance Percentage (%)</label>
                    <input type="number" class="form-input" id="attendance" min="0" max="100" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Study Hours (per week)</label>
                    <input type="number" class="form-input" id="studyHours" min="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Assignment Scores (%)</label>
                    <input type="number" class="form-input" id="assignments" min="0" max="100" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Previous GPA</label>
                    <input type="number" class="form-input" id="gpa" min="0" max="4.0" step="0.1" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Participation Level (1-10)</label>
                    <input type="number" class="form-input" id="participation" min="1" max="10" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Internet Usage (Hours/day)</label>
                    <input type="number" class="form-input" id="internet" min="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Sleep Hours</label>
                    <input type="number" class="form-input" id="sleep" min="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Family Support Index (1-10)</label>
                    <input type="number" class="form-input" id="family" min="1" max="10" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Extra-Curricular (1-10)</label>
                    <input type="number" class="form-input" id="extracurricular" min="1" max="10" required>
                </div>
            </div>
            <div class="form-actions" style="margin-top: 2.5rem; text-align: center;">
                <button type="submit" class="btn-primary magnetic">
                    <i class="fa-solid fa-microchip"></i> Run Prediction AI
                </button>
            </div>
        </form>
    </div>

    <!-- Animated Output Card -->
    <div class="glass-card output-card-container magnetic" id="outputCard">
        <div class="output-content">
            <h3 style="color: var(--text-muted); font-weight: 500; text-transform: uppercase; letter-spacing: 2px;">AI
                Diagnostics</h3>

            <div class="progress-circle" id="progressCircle">
                <div class="progress-inner">
                    <span class="score-value" id="scoreValue">0</span>
                    <span class="score-label">Score</span>
                </div>
            </div>

            <div id="performanceStatus" class="performance-status">Evaluating...</div>
            <p id="performanceDesc" style="color: var(--text-muted); max-width: 500px;"></p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        // Form & Output Logic
        const form = document.getElementById('predictionForm');
        const outputCard = document.getElementById('outputCard');
        const scoreValue = document.getElementById('scoreValue');
        const progressCircle = document.getElementById('progressCircle');
        const performanceStatus = document.getElementById('performanceStatus');
        const performanceDesc = document.getElementById('performanceDesc');

        // Drag and Drop
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                const fileName = e.dataTransfer.files[0].name;
                uploadZone.querySelector('.upload-text').innerHTML = `File loaded: <strong class="text-cyan">${fileName}</strong>`;
            }
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const fileName = e.target.files[0].name;
                uploadZone.querySelector('.upload-text').innerHTML = `File loaded: <strong class="text-cyan">${fileName}</strong>`;
            }
        });

        // Sample Data Generation
        document.getElementById('btnGenerate').addEventListener('click', () => {
            document.getElementById('attendance').value = Math.floor(Math.random() * 40 + 60);
            document.getElementById('studyHours').value = Math.floor(Math.random() * 30 + 5);
            document.getElementById('assignments').value = Math.floor(Math.random() * 50 + 50);
            document.getElementById('gpa').value = (Math.random() * 2 + 2).toFixed(1);
            document.getElementById('participation').value = Math.floor(Math.random() * 8 + 2);
            document.getElementById('internet').value = Math.floor(Math.random() * 6 + 1);
            document.getElementById('sleep').value = Math.floor(Math.random() * 4 + 5);
            document.getElementById('family').value = Math.floor(Math.random() * 8 + 2);
            document.getElementById('extracurricular').value = Math.floor(Math.random() * 9 + 1);

            const inputs = document.querySelectorAll('.form-input');
            inputs.forEach(input => {
                input.style.borderColor = 'var(--primary-start)';
                input.style.boxShadow = '0 0 10px rgba(79, 140, 255, 0.3)';
                setTimeout(() => {
                    input.style.borderColor = 'rgba(79, 140, 255, 0.3)';
                    input.style.boxShadow = 'none';
                }, 800);
            });
        });

        // Form Submit Simulation
        form.addEventListener('submit', (e) => {
            e.preventDefault();

            const att = parseFloat(document.getElementById('attendance').value || 0);
            const gpa = parseFloat(document.getElementById('gpa').value || 0);
            const study = parseFloat(document.getElementById('studyHours').value || 0);

            let score = (att * 0.4) + ((gpa / 4) * 100 * 0.4) + (Math.min(study / 30, 1) * 100 * 0.2);
            score = Math.max(0, Math.min(100, Math.floor(score)));

            outputCard.style.display = 'block';

            gsap.fromTo(outputCard,
                { opacity: 0, scale: 0.95, y: 30 },
                { opacity: 1, scale: 1, y: 0, duration: 0.8, ease: "back.out(1.2)" }
            );

            setTimeout(() => { outputCard.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);

            let currentObject = { val: 0 };
            gsap.to(currentObject, {
                val: score,
                duration: 2,
                ease: "power2.out",
                onUpdate: function () {
                    const currentScore = Math.floor(currentObject.val);
                    scoreValue.innerText = currentScore;

                    let colorCode = currentScore >= 80 ? '#00D4FF' : (currentScore >= 60 ? '#A66CFF' : '#FF4D4D');

                    progressCircle.style.background = `conic-gradient(${colorCode} ${currentScore}%, rgba(0,0,0,0.05) 0%)`;
                    progressCircle.style.boxShadow = `0 0 30px ${colorCode}66`;
                },
                onComplete: function () {
                    if (score >= 80) {
                        performanceStatus.innerText = "High Performer";
                        performanceStatus.style.color = '#00D4FF';
                        performanceDesc.innerText = "Exceptional projected performance. Try taking on advanced extracurricular projects.";
                    } else if (score >= 60) {
                        performanceStatus.innerText = "Balanced";
                        performanceStatus.style.color = '#A66CFF';
                        performanceDesc.innerText = "Solid standing. Identify minor gaps in attendance or study habits to breach the top tier.";
                    } else {
                        performanceStatus.innerText = "At Risk";
                        performanceStatus.style.color = '#FF4D4D';
                        performanceDesc.innerText = "Critical intervention recommended. Boost core study metrics immediately.";
                    }
                }
            });
        });
    });
</script>
{% endblock %}